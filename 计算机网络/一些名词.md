### 网络地址转换协议（NAT协议）

因为IPv4协议存在网络地址耗尽的问题，不能为一个公司提供足够的地址，因此内网IP可能会和外网重复。比如内网IP地址192.168.0.1发送信息给22.22.22.22，这个时候，其实是跨着网络的。当内网IP192.168.0.1想要访问百度时，首先会先转换成公网IP再通过网关去连接百度。

当百度寻找内网IP192.168.0.1的时候，是寻找的一个私网IP，这个时候是找不到的。解决方案就是网络地址转换技术（Network Address Transform）。

![image-20210907104638055](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210907104638055.png)

NAT技术转换的是IP地址，私有IP通过NAT转换成公网IP发送到服务器。服务器的响应后，通过NAT将公网IP转换成私有IP，返回到客户端。通过这种方式，就解决了内网和外网的通信问题。

#### 注意

* 公网IP具有世界范围的唯一性，而内网IP只在局域网内部具有唯一性。
* 在局域网中，每台电脑都可以自己分配自己的IP，但是这个IP只在局域网中有效。而如果你将电脑连接到互联网，你的网络提供商的服务器会为你分配一个IP地址，这个IP地址才是你在外网的IP。两个IP同时存在，一个对内，一个对外。
* 互联网上的IP（即外网IP）地址统一由一个叫`IANA`（互联网网络号分配机构）的组织来管理。由于分配不合理以及IPv4协议本身存在的局限，现在互联网的IP地址资源越来越紧张。`IANA`将A，B，C类IP地址的一部分保留下来，留作局域网使用。具体如下
  * A类网：10.0.0.0~10.255.255.255
  * B类网：172.16.0.0~172.31.255.255
  * C类网：192.168.0.0~192.168.255.255

### 局域网数据交换（MAC地址）

设备间通信的本质其实是设备拥有的网络接口（网卡）间的通信。为了区别每个网络接口，互联网工程任务组（IETF）要求每个设备拥有一个唯一的编号，这个就是MAC地址

IP地址就像是生活中的地址，而MAC地址更像是身份证号。

### 地址解析协议（ARP）

问题1：对于一个网络接口，它如何能知道目标接口的MAC地址呢？

在使用传输层协议的时候，清楚地知道目的地的IP地址，但是我们不知道MAC地址。但是我们只有IP地址，因此我们可以通过IP地址找到MAC地址，这个中间服务就是地址解析协议（ARP）

ARP是如何工作的呢

整个工作过程和DNS非常类似的，都是逐级缓存的设计减少ARP请求的。发送方会先查询本地的ARP表，如果本地没有数据，然后广播ARP查询。这个时候如果交换机中有数据，那么查询交换机的ARP表；如果交换中没有数据，才去广播消息给其他接口。注意：**ARP表示一种缓存**